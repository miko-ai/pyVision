<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
  <!-- Enable responsiveness on mobile devices-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">-->
 

  <title>
    
      GitPod Self Host Installation on K3S &middot; 
      pyVision
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/pyVision/public/css/poole.css">
  <link rel="stylesheet" href="/pyVision/public/css/syntax.css">
  <link rel="stylesheet" href="/pyVision/public/css/lanyon.css">
  <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">-->
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/pyVisionpublic/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/pyVisionpublic/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({ 
                config: ["MMLorHTML.js"], 
                extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"], 
                jax: ["input/TeX"], 
                tex2jax: { 
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ], 
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ], 
                    processEscapes: false 
                }, 
                TeX: { 
                    TagSide: "right", 
                    TagIndent: ".8em", 
                    MultLineWidth: "85%", 
                    equationNumbers: { 
                       autoNumber: "AMS", 
                    }, 
                    unicode: { 
                       fonts: "STIXGeneral,'Arial Unicode MS'" 
                    } 
                }, 
                showProcessingMessages: false 
            }); 
</script>
<!--<script src="/pyVision/javascripts/gitdata.js"></script>-->
	<script type="text/javascript">
    	$(function() {
        $("#display-projects").getRepos("pi19404"); //Add your github username.
    	});
	</script>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shCore.css' rel='stylesheet' type='text/css'/> 
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/> 
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shCore.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCpp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCSharp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCss.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJava.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJScript.js' type='text/javascript' /> </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPhp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPython.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushRuby.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushSql.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushVb.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushXml.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPerl.js' type='text/javascript' > </script>
<script language='javascript'> 
SyntaxHighlighter.config.bloggerMode = false;
SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38535188-2', 'auto');
  ga('send', 'pageview');

</script>
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">





  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/pyVision/">Home </a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pyVision//about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    

    <!-- <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision/zipball/master">Download</a>
    <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision">GitHub project</a> -->
    <a class="sidebar-nav-item" ><g:plusone size="medium">Categories</g:plusone> </a>
    <div>
      <ul>
        
        
        <li><a href="/pyVision//category/Linux/index.html">Linux</a></li>
        
        
        <li><a href="/pyVision//category/Signal+Processing/index.html">Signal Processing</a></li>
        
        
        <li><a href="/pyVision//category/Raspberry+PI/index.html">Raspberry PI</a></li>
        
        
        <li><a href="/pyVision//category/Software/index.html">Software</a></li>
        
        
        <li><a href="/pyVision//category/Embedded+Firmware/index.html">Embedded Firmware</a></li>
        
        
        <li><a href="/pyVision//category/Software+Installation/index.html">Software Installation</a></li>
        
        
        <li><a href="/pyVision//category/Software+installation/index.html">Software installation</a></li>
        
        </ul>
    
    </div>
<a class="sidebar-nav-item" >
<div class='g-person' data-href='https://plus.google.com/115840780257908006648' data-layout='landscape' data-rel='author' data-showcoverphoto='false' data-showtagline='false' data-theme='dark' data-width='100'></a>
</div>

<div class='widget-content'>
<script type="text/javascript" src="http://jj.revolvermaps.com/2/1.js?i=9bj6dpaloim&amp;s=220&amp;m=7&amp;v=true&amp;r=true&amp;b=ffffff&amp;n=false&amp;c=ff0000" async="async"></script>
</div>

<script type="text/javascript">
function cantload() {
img = document.getElementById("clustrMapsImg");
img.onerror = null;
img.src = "http://www2.clustrmaps.com/images/clustrmaps-back-soon.jpg";
document.getElementById("clustrMapsLink").href = "http://www2.clustrmaps.com";
}
img = document.getElementById("clustrMapsImg");
img.onerror = cantload;
</script>
<div class='widget-content'>
<div id="clustrmaps-widget"></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://pi-virtualworld.blogspot.com', 'user' : 1165875, 'server' : '3', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2015-04-05', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www3.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www3.clustrmaps.com/user/ace11ca33"><img src="http://www3.clustrmaps.com/stats/maps-no_clusters/pi-virtualworld.blogspot.com-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript>
</a>

<!-- Copyright (c)2009 Site Meter -->


</div>

<div class='widget-content'>
<script type="text/javascript" src="http://feedjit.com/serve/?vv=1022&amp;tft=3&amp;dd=0&amp;wid=f31e21a2d981f025&amp;pid=0&amp;proid=0&amp;bc=000000&amp;tc=F5F5F5&amp;brd1=454545&amp;lnk=C95050&amp;hc=FFFFFF&amp;hfc=5C5A5A&amp;btn=8A0214&amp;ww=200&amp;went=10"></script><noscript><a href="http://feedjit.com/">Feedjit Live Blog Stats</a></noscript>
</div>
 
<!-- Site Meter -->
<script type="text/javascript" src="http://s30.sitemeter.com/js/counter.js?site=s30pi19404">
</script>
<noscript>
<a href="http://s30.sitemeter.com/stats.asp?site=s30pi19404" target="_top">
<img src="http://s30.sitemeter.com/meter.asp?site=s30pi19404" alt="Site Meter" border="0"/></a>
</noscript>   
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2022. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      
        <div class="container">
          <h1 class="header">
            <a href="/" title="Home">pyVision</a></br>
            <small>A Machine Learning and Signal Processing toolbox</small>
          </h1>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/pi19404/pyVision/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/pi19404/pyVision/tarball/master" id="download-tar-gz" class="button"><span>Download.tar.gz</span></a>
          <a href="https://github.com/pi19404/pyVision" id="view-on-github" class="button"><span>View on GitHub</span></a>
		
	   <hr>
          </section>
    
	</br>	</br>
      <div class="content">
        <article class="post">
  <h1 class="post-title">GitPod Self Host Installation on K3S</h1>
  <span class="post-date">07 May 2022</span>
  <h1 id="gitpod-installation">GitPod Installation</h1>

<h3 id="step-1-create-a-kubernetes-cluster-">Step 1: Create a Kubernetes Cluster <a href="#step-1-create-a-kubernetes-cluster" id="step-1-create-a-kubernetes-cluster"></a></h3>

<p>Gitpod is a Kubernetes application that uses Kubernetes internally to provision workspaces as Kubernetes pods. Before you can start installing Gitpod, you need to create a compatible Kubernetes cluster. </p>

<h1 id="install-k3s-kubernets-cluster">Install K3S Kubernets Cluster</h1>

<h2 id="cluster-set-up-">Cluster Set-Up <a href="#cluster-set-up" id="cluster-set-up"></a></h2>

<p>Gitpod is a Kubernetes application running with certain expectations on the characteristics of the cluster it is running on.</p>

<p>Gitpod requires Kubernetes as an orchestration technology in order to spin up and down workspaces—ideally in combination with cluster autoscaling to minimise cost. We strongly recommend deploying a dedicated Kubernetes cluster just for Gitpod Self-Hosted.</p>

<p>In this article we will use k8s to setup a self managed kubernetes cluster</p>

<p>K3s is a highly available, certified Kubernetes distribution designed for production workloads in unattended, resource-constrained, remote locations or inside IoT appliances.</p>

<p>On each node, we <a href="https://rancher.com/docs/k3s/latest/en/installation/">install K3s</a>. We configure K3s by setting the following environment variables on the nodes.</p>

<p>K3s config for main node <code class="language-plaintext highlighter-rouge">node0</code>: </p>

<p>The below configure is for a single node setup with only master node</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">INSTALL_K3S_EXEC</span><span class="o">=</span><span class="s2">"server --disable traefik --flannel-backend=none --node-label gitpod.io/workload_meta=true --node-label gitpod.io/workload_ide=true -node-label gitpod.io/workload_workspace_services=true --node-label gitpod.io/workload_workspace_regular=true --node-label gitpod.io/workload_workspace_headless=true"</span>
<span class="nb">export </span><span class="nv">K3S_CLUSTER_SECRET</span><span class="o">=</span><span class="s2">"44dc0c2d471f50bc151aa72515d53067"</span>
curl <span class="nt">-sfL</span> https://get.k3s.io | sh -
</code></pre></div></div>

<p>After setting the environment variables, install K3s on every node like this:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-sfL</span> https://get.k3s.io | sh -
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Check for Ready node,
takes maybe 30 seconds
k3s kubectl get node
</code></pre></div></div>

<p>You can run the below command to start the server </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start k3s.service
# Kubeconfig is written to /etc/rancher/k3s/k3s.yaml
k3s kubectl get node
</code></pre></div></div>

<p>To enable any other node to join the cluster run the command</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># On a different node run the below. NODE_TOKEN comes from /var/lib/rancher/k3s/server/node-token
# on your server
export INSTALL_K3S_EXEC="agent --node-label gitpod.io/workload_workspace_services=true --node-label gitpod.io/workload_workspace_regular=true --node-label gitpod.io/workload_workspace_headless=true"
export K3S_CLUSTER_SECRET="&lt;your random secret string that is the same on all nodes&gt;"
export K3S_URL="https://node0:6443"
</code></pre></div></div>

<p>Now, you have to install <a href="https://www.tigera.io/project-calico/">Calico</a>. </p>

<p><strong>Method 1</strong></p>

<p>Download the <a href="https://docs.projectcalico.org/manifests/calico-vxlan.yaml">Calico manifest</a> and add the following line to the <code class="language-plaintext highlighter-rouge">plugins</code> section of the <code class="language-plaintext highlighter-rouge">cni_network_config</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"container_settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"allow_ip_forwarding"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/lib/rancher/k3s/server/manifests/
</code></pre></div></div>

<p>Copy that file to <code class="language-plaintext highlighter-rouge">node0</code> in the following folder (create folder if missing):</p>

<p><strong>Method 2</strong></p>

<p>Install the Calico operator and custom resource definitions.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create -f https://projectcalico.docs.tigera.io/manifests/tigera-operator.yaml
</code></pre></div></div>

<p>Install Calico by creating the necessary custom resource. For more information on configuration options available in this manifest, see <a href="https://projectcalico.docs.tigera.io/reference/installation/api">the installation reference</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create -f https://projectcalico.docs.tigera.io/manifests/custom-resources.yaml
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: Before creating this manifest, read its contents and make sure its settings are correct for your environment. For example, you may need to change the default IP pool CIDR to match your pod network CIDR.</p>
</blockquote>

<p><strong>Final checks</strong></p>

<ol>
  <li>Confirm that all of the pods are running using the following command.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>watch kubectl get pods --all-namespaces
</code></pre></div></div>

<p>Wait until each pod shows the <code class="language-plaintext highlighter-rouge">STATUS</code> of <code class="language-plaintext highlighter-rouge">Running</code>.</p>

<p><img src="../../.gitbook/assets/image (7) (1).png" alt="" /></p>

<p>Confirm that you now have a node in your cluster with the following command.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get nodes -o wide
</code></pre></div></div>

<p><img src="../../.gitbook/assets/image (8).png" alt="" /><br />
References</p>

<ul>
  <li><a href="https://www.gitpod.io/docs/self-hosted/latest/cluster-set-up/on-k3s">https://www.gitpod.io/docs/self-hosted/latest/cluster-set-up/on-k3s</a></li>
  <li><a href="https://www.gitpod.io/docs/self-hosted/latest/getting-started#step-2-install-cert-manager">https://www.gitpod.io/docs/self-hosted/latest/getting-started#step-2-install-cert-manager</a></li>
  <li><a href="https://projectcalico.docs.tigera.io/getting-started/kubernetes/k3s/quickstart">https://projectcalico.docs.tigera.io/getting-started/kubernetes/k3s/quickstart</a></li>
</ul>

<h3 id="step-2-install-cert-manager-">Step 2: Install Cert-Manager <a href="#step-2-install-cert-manager" id="step-2-install-cert-manager"></a></h3>

<p>Once you have created your Kubernetes cluster you need to install <a href="https://cert-manager.io">cert-manager</a>. cert-manager is needed in any case even when you bring your own TLS certificate for your domain. </p>

<h1 id="install-cert-manager-on-kubernetes-cluster">Install cert-manager on kubernetes cluster</h1>

<p>cert-manager is a Kubernetes add-on to automate the management and issuance of TLS certificates from various issuing sources.</p>

<p>It will ensure certificates are valid and up to date periodically, and attempt to renew certificates at an appropriate time before expiry.</p>

<p>on the same node where k3s master was installed run the below command to install the cert manager</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>k3s kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.8.0/cert-manager.yaml
    
</code></pre></div></div>

<p>By default, cert-manager will be installed into the <code class="language-plaintext highlighter-rouge">cert-manager</code> namespace</p>

<p><strong>Creating TLS certs for your domain with cert-manager</strong></p>

<p>cert-manager provides the Gitpod installation with certificates for internal communication. Besides this, cert-manager can also create a TLS certificate for your domain. Since Gitpod needs wildcard certificates, you must use the <a href="https://letsencrypt.org/docs/challenge-types/#dns-01-challenge">DNS-01 challenge</a>.</p>

<p>You can use either an <a href="https://cert-manager.io/docs/concepts/issuer"><code class="language-plaintext highlighter-rouge">Issuer</code> or <code class="language-plaintext highlighter-rouge">ClusterIssuer</code></a>.</p>

<p><code class="language-plaintext highlighter-rouge">Issuers</code>, and <code class="language-plaintext highlighter-rouge">ClusterIssuers</code>, are Kubernetes resources that represent certificate authorities (CAs) that are able to generate signed certificates by honoring certificate signing requests. All cert-manager certificates require a referenced issuer that is in a ready condition to attempt to honor the request.</p>

<p><strong>we will use the domain</strong> miko-robot.co.in , DNS provide is onlydomains . We will first delegate the domain to cloudflare and then use cloudflare for DNS01 challenge </p>

<p>Create and Account and Login into cloudflare . Click on Add a Site option to start the domain delegation process</p>

<p><img src="../../.gitbook/assets/image (2).png" alt="" /></p>

<p>For now choose the Free option and continue</p>

<p><img src="../../.gitbook/assets/image.png" alt="" /></p>

<p><strong>Log in</strong> to the <strong>administrator account</strong> for your domain registrar . In this case domain registrar is onlydomain.com . </p>

<ol>
  <li>
    <p><strong>By Default</strong> the following nameservers are configured</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ns2.onlydomains.com , ns3.onlydomains.com , ns1.onlydomains.com
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Go to DNS Settings Menu</strong></p>
  </li>
</ol>

<p><strong>Choose the option to delegate name server Add</strong> Cloudflare’s nameservers</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tegan.ns.cloudflare.com
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zod.ns.cloudflare.com
</code></pre></div></div>

<p><img src="../../.gitbook/assets/image (4).png" alt="" /></p>

<p>This will update the DNS Settings and allow the DNS to be managed via cloudflare</p>

<h3 id="create-cloudflare-api-tokens-">Create CloudFlare API Tokens <a href="#api-tokens" id="api-tokens"></a></h3>

<p>Tokens can be created at <strong>User Profile &gt; API Tokens &gt; API Tokens</strong>. The following settings are recommended:</p>

<ul>
  <li>Permissions:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Zone - DNS - Edit</code></li>
      <li><code class="language-plaintext highlighter-rouge">Zone - Zone - Read</code></li>
    </ul>
  </li>
  <li>Zone Resources:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Include - All Zones</code></li>
    </ul>
  </li>
</ul>

<p><img src="../../.gitbook/assets/image (5).png" alt="" /></p>

<p>Copy The token and save it as it will not be displayed again for security purposes</p>

<p><strong>Verify that the token is working</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -X GET "https://api.cloudflare.com/client/v4/user/tokens/verify"
-H "Authorization: Bearer {TOKEN}"
-H "Content-Type:application/json"
</code></pre></div></div>

<p>If token is working then you will see a output similar to one below</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{"result":{"id":"cf4a06f05d43d58468667ba715145c34","status":"active"},"success":true,"errors":[],"messages":[{"code":10000,"message":"This API Token is valid and active","type":null}]}
</code></pre></div></div>

<p><strong>Create a new Issuer</strong></p>

<p>To create a new <code class="language-plaintext highlighter-rouge">Issuer</code>, first make a Kubernetes secret containing your new API token:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: Secret
metadata:
 name: cloudflare-api-token-secret
 namespace: cert-manager
type: Opaque
stringData:
 api-token: {TOKEN}
</code></pre></div></div>

<p>Please note that the namespace has to be cert-manager for the key else you may encounter error while creating the certificates</p>

<p>To apply the configuration</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>k3s kubectl apply -f cloudflare_token.yaml
</code></pre></div></div>

<p><strong>Create Issuer configuration file</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind: ClusterIssuer
metadata:
  name: gitpod-issuer
spec:
  acme:
    email: prashant@miko.ai
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    privateKeySecretRef:
      name: gitpod-issuer
    solvers:
    - dns01:
        cloudflare:
          email : aaa@aaa.com
          apiTokenSecretRef:
            name: cloudflare-api-token-secret
            key: api-token
</code></pre></div></div>

<p>Once you complete the gitpod installation create the below certificates in gitpod and kube-system workspace both</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
 name: https-certificates
 namespace : kube-system
spec:
 secretName: https-certificates
 issuerRef:
   name: gitpod-issuer
   kind: ClusterIssuer
 dnsNames:
  - gitpod.miko-robot.co.in
  - "*.gitpod.miko-robot.co.in"
  - "*.ws.gitpod.miko-robot.co.in"
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
 name: https-certificates
 namespace : gitpod
spec:
 secretName: https-certificates
 issuerRef:
   name: gitpod-issuer
   kind: ClusterIssuer
 dnsNames:
  - gitpod.miko-robot.co.in
  - "*.gitpod.miko-robot.co.in"
  - "*.ws.gitpod.miko-robot.co.in"
</code></pre></div></div>

<p>To apply the configuration</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>k3s kubectl apply -f cert.yaml
</code></pre></div></div>

<p>While certificate issuance process is in progress you will see the status as False</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get certificate
NAME                        READY   SECRET                      AGE
https-certificates          False    https-certificates          5m
</code></pre></div></div>

<p>After a few minutes, you should see the <code class="language-plaintext highlighter-rouge">https-certificate</code> become ready.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get certificate
NAME                        READY   SECRET                      AGE
https-certificates          True    https-certificates          5m
</code></pre></div></div>

<p>Once the DNS record has been updated, you can delete all Cert Manager pods to retrigger the certificate request</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete pods -n cert-manager --all
</code></pre></div></div>

<p><strong>References</strong></p>

<p><a href="https://cert-manager.io/docs/configuration/acme/dns01/cloudflare/">https://cert-manager.io/docs/configuration/acme/dns01/cloudflare/</a></p>

<h3 id="step-3-configure-dns-">Step 3: Configure DNS <a href="#step-3-configure-dns" id="step-3-configure-dns"></a></h3>

<p>To install Gitpod you need a domain with a TLS certificate. The DNS setup to your domain needs to be configured such that it points to the ingress of your Kubernetes cluster.</p>

<h1 id="configure-dns">Configure DNS</h1>

<p>To install Gitpod you need a domain with a TLS certificate. The DNS setup to your domain needs to be configured such that it points to the ingress of your Kubernetes cluster. You need to configure your actual domain (say <code class="language-plaintext highlighter-rouge">example.com</code>) as well as the wildcard subdomains <code class="language-plaintext highlighter-rouge">*.example.com</code> as well as <code class="language-plaintext highlighter-rouge">*.ws.example.com</code>.</p>

<h3 id="step-4-install-gitpod-">Step 4: Install Gitpod <a href="#step-4-install-gitpod" id="step-4-install-gitpod"></a></h3>

<h1 id="gitpod-installation-1">GitPod Installation</h1>

<table>
  <tbody>
    <tr>
      <td>To start with installing Gitpod, you need a terminal where you can run <code class="language-plaintext highlighter-rouge">kubectl</code> to access your cluster. At first, install the KOTS kubectl plugicurl https://kots.io/install</td>
      <td>bash</td>
    </tr>
  </tbody>
</table>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl kots <span class="nb">install </span>gitpod
</code></pre></div></div>

<p>You will be asked for the namespace you want to install Gitpod to as well as a password for the admin console. After some time, you will see the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  • Press Ctrl+C to exit
  • Go to http://localhost:8800 to access the Admin Console
</code></pre></div></div>

<p>To access the Admin Console again, run kubectl kots admin-console –namespace gitpod</p>

<p>Open your favorite browser and go to <code class="language-plaintext highlighter-rouge">http://localhost:8800</code> (port <code class="language-plaintext highlighter-rouge">8800</code> is opened on your node on <code class="language-plaintext highlighter-rouge">localhost</code> only—you may want to forward the port to your workstation in order to access the admin console).</p>

<p>we will use ngrok for port forwarding</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ngrok http 8800
</code></pre></div></div>

<p><img src="../../.gitbook/assets/image (6) (1).png" alt="" /></p>

<p>The first page will ask you to upload your Gitpod license. Gitpod provides community license for free (right click and save link as <a href="https://raw.githubusercontent.com/gitpod-io/gitpod/main/install/licenses/Community.yaml">here</a>)</p>

<p>. </p>

<p><img src="../../.gitbook/assets/image (1).png" alt="" /></p>

<p>Enter the domain name as :gitpod.miko-robot.co.in</p>

<p>User all the default settings for incluster container registry , mysql database , storage provide</p>

<p>User cert-manager for SSL certificates and use Issuer type as “Issuer”</p>

<p>Mark Allow login by into workspace via ssh</p>

<p>Check if all the pods are running states</p>

<p><img src="../../.gitbook/assets/image (7).png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl -n gitpod patch svc proxy -p '{"spec": {"type": "LoadBalancer", "externalIPs":["xxx.xxx.xxx.xx"]}}'
</code></pre></div></div>

<p>Once the installation has been finished successfully, you will see the status “Ready” with a small green indicator next to the Gitpod logo. You see which version you installed and which license you are using.</p>

<p><img src="../../.gitbook/assets/image (6).png" alt="" /></p>


</article>
<div id="page-navigation"> 
        <div class="clear">&nbsp;</div> 
        <div class="left"> 
         
                <a href="/pyVision//linux/2022/05/05/ngrok/" title="Previous Post: 
Install ngrok on Ubuntu 20.04">&laquo; Install ngrok on Ubuntu 20.04</a> 
         
        </div> 

        <div class="right"> 
         
        </div> 
        <div class="clear">&nbsp;</div> 
</div> 
<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'pi19404'; // required: replace example with your forum shortname
    			var disqus_identifier = '/linux/2022/05/07/gitpod1/';
    			var disqus_url = 'http://pyvision.github.com/linux/2022/05/07/gitpod1/';       
 
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





      </div>
    </div>

      
       <footer>
          pyVision is maintained by <a href="https://github.com/pi19404">pi19404</a><br>
        </footer>
    
    </div>
 <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = true;
        }, false);
      })(document);
    </script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pyvision'; // required: replace example with your forum shortname
    var disqus_identifier = '/linux/2022/05/07/gitpod1/';
    var disqus_url = 'http://pyvision.github.com/linux/2022/05/07/gitpod1/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

  </body>
</html>
