<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
  <!-- Enable responsiveness on mobile devices-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">-->
 

  <title>
    
      Android Native Programming C/C++ with OpenCV &middot; 
      pyVision
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/pyVision/public/css/poole.css">
  <link rel="stylesheet" href="/pyVision/public/css/syntax.css">
  <link rel="stylesheet" href="/pyVision/public/css/lanyon.css">
  <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">-->
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/pyVisionpublic/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/pyVisionpublic/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({ 
                config: ["MMLorHTML.js"], 
                extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"], 
                jax: ["input/TeX"], 
                tex2jax: { 
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ], 
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ], 
                    processEscapes: false 
                }, 
                TeX: { 
                    TagSide: "right", 
                    TagIndent: ".8em", 
                    MultLineWidth: "85%", 
                    equationNumbers: { 
                       autoNumber: "AMS", 
                    }, 
                    unicode: { 
                       fonts: "STIXGeneral,'Arial Unicode MS'" 
                    } 
                }, 
                showProcessingMessages: false 
            }); 
</script>
<!--<script src="/pyVision/javascripts/gitdata.js"></script>-->
	<script type="text/javascript">
    	$(function() {
        $("#display-projects").getRepos("pi19404"); //Add your github username.
    	});
	</script>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shCore.css' rel='stylesheet' type='text/css'/> 
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/> 
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shCore.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCpp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCSharp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCss.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJava.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJScript.js' type='text/javascript' /> </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPhp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPython.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushRuby.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushSql.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushVb.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushXml.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPerl.js' type='text/javascript' > </script>
<script language='javascript'> 
SyntaxHighlighter.config.bloggerMode = false;
SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38535188-2', 'auto');
  ga('send', 'pageview');

</script>
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">





  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/pyVision/">Home </a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pyVision//about/">About</a>
        
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    

    <!-- <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision/zipball/master">Download</a>
    <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision">GitHub project</a> -->
    <!-- <a class="sidebar-nav-item" ><g:plusone size="medium">Categories</g:plusone> </a> -->

    <div >
      <nav class="sidebar-nav-item">
        <g:plusone size="medium">Categories</g:plusone>
        
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/ai">
            AI
         </a>
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/embedded-firmware">
            Embedded Firmware
         </a>
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/linux">
            Linux
         </a>
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/raspberry-pi">
            Raspberry PI
         </a>
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/signal-processing">
            Signal Processing
         </a>
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/software">
            Software
         </a>
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/software-installation">
            Software Installation
         </a>
        
         
         <a class="sidebar-nav-item" href="/pyVision/category1/software-installation">
            Software installation
         </a>
        
      </nav>
    
    </div>
    <!-- <div>
      <ul>
        
        
        <li><a href="/pyVision//category/AI/index.html">AI</a></li>
        
        
        <li><a href="/pyVision//category/Signal+Processing/index.html">Signal Processing</a></li>
        
        
        <li><a href="/pyVision//category/Raspberry+PI/index.html">Raspberry PI</a></li>
        
        
        <li><a href="/pyVision//category/Linux/index.html">Linux</a></li>
        
        
        <li><a href="/pyVision//category/Software/index.html">Software</a></li>
        
        
        <li><a href="/pyVision//category/Embedded+Firmware/index.html">Embedded Firmware</a></li>
        
        
        <li><a href="/pyVision//category/Software+Installation/index.html">Software Installation</a></li>
        
        
        <li><a href="/pyVision//category/Software+installation/index.html">Software installation</a></li>
        
        </ul>
    
    </div> -->
<a class="sidebar-nav-item" >
<div class='g-person' data-href='https://plus.google.com/115840780257908006648' data-layout='landscape' data-rel='author' data-showcoverphoto='false' data-showtagline='false' data-theme='dark' data-width='100'></a>
</div>

<div class='widget-content'>
<script type="text/javascript" src="http://jj.revolvermaps.com/2/1.js?i=9bj6dpaloim&amp;s=220&amp;m=7&amp;v=true&amp;r=true&amp;b=ffffff&amp;n=false&amp;c=ff0000" async="async"></script>
</div>

<script type="text/javascript">
function cantload() {
img = document.getElementById("clustrMapsImg");
img.onerror = null;
img.src = "http://www2.clustrmaps.com/images/clustrmaps-back-soon.jpg";
document.getElementById("clustrMapsLink").href = "http://www2.clustrmaps.com";
}
img = document.getElementById("clustrMapsImg");
img.onerror = cantload;
</script>
<div class='widget-content'>
<div id="clustrmaps-widget"></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://pi-virtualworld.blogspot.com', 'user' : 1165875, 'server' : '3', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2015-04-05', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www3.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www3.clustrmaps.com/user/ace11ca33"><img src="http://www3.clustrmaps.com/stats/maps-no_clusters/pi-virtualworld.blogspot.com-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript>
</a>

<!-- Copyright (c)2009 Site Meter -->


</div>

<div class='widget-content'>
<script type="text/javascript" src="http://feedjit.com/serve/?vv=1022&amp;tft=3&amp;dd=0&amp;wid=f31e21a2d981f025&amp;pid=0&amp;proid=0&amp;bc=000000&amp;tc=F5F5F5&amp;brd1=454545&amp;lnk=C95050&amp;hc=FFFFFF&amp;hfc=5C5A5A&amp;btn=8A0214&amp;ww=200&amp;went=10"></script><noscript><a href="http://feedjit.com/">Feedjit Live Blog Stats</a></noscript>
</div>
 
<!-- Site Meter -->
<script type="text/javascript" src="http://s30.sitemeter.com/js/counter.js?site=s30pi19404">
</script>
<noscript>
<a href="http://s30.sitemeter.com/stats.asp?site=s30pi19404" target="_top">
<img src="http://s30.sitemeter.com/meter.asp?site=s30pi19404" alt="Site Meter" border="0"/></a>
</noscript>   
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2022. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      
        <div class="container">
          <h1 class="header">
            <a href="/" title="Home">pyVision</a></br>
            <small>A Machine Learning and Signal Processing toolbox</small>
          </h1>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/pi19404/pyVision/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/pi19404/pyVision/tarball/master" id="download-tar-gz" class="button"><span>Download.tar.gz</span></a>
          <a href="https://github.com/pi19404/pyVision" id="view-on-github" class="button"><span>View on GitHub</span></a>
		
	   <hr>
          </section>
    
	</br>	</br>
      <div class="content">
        <article class="post">
  <h1 class="post-title">Android Native Programming C/C++ with OpenCV</h1>
  <span class="post-date">17 Apr 2015</span>
  <h3 id="introduction">Introduction</h3>

<p>This article describes how to setup Eclipse for using C/C++ OpenCV Programs together with Java in Android projects.</p>

<h3 id="installation-and-code-compilation">Installation and Code Compilation</h3>

<p>Before Proceeding make sure that you have all the below software components installed and configured in Eclipse</p>

<p>To develop your application via Eclipse, you need to install the following softwares.</p>

<ul>
  <li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit 7+ (JDK)</a></li>
  <li>Eclipse, the “<a href="https://www.eclipse.org/downloads/packages/eclipse-ide-java-developers/lunasr2">Eclipse IDE for Java Developers</a>” .</li>
  <li><a href="http://developer.android.com/sdk/installing.html">Android SDK</a></li>
  <li>Android Development Tools for Eclipse, aka ADT Plugin.
    <ul>
      <li>Update site: https://dl-ssl.google.com/android/eclipse/</li>
      <li>Detailed instructions can be found at</li>
    </ul>
  </li>
  <li>Android NDK
    <ul>
      <li>The NDK is a toolset that allows you to implement parts of your app using native-code languages such as C and C++</li>
      <li>It can be downloaded from http://developer.android.com/tools/sdk/ndk/index.html</li>
    </ul>
  </li>
  <li>
    <p>Eclipse CDT for C/C++ support  - Install CDT from Eclipse update site http://download.eclipse.org/tools/cdt/releases/indigo.</p>
  </li>
  <li>
    <p>OpenCV 2.4.3 precompile libraries - https://github.com/pi19404/OpenCVAndroid/blob/master/opencv_arm_libs.tar.gz</p>
  </li>
  <li>OpenCV sources
Get the OpenCV Sources from github repository https://github.com/Itseez/opencv.git</li>
</ul>

<p><strong>Configuring Eclipse</strong>
Configure eclipse to set the path for Android SDK and NDK</p>

<ul>
  <li>Eclipse -&gt; Window -&gt; Preferences -&gt; Android -&gt; set path to SDK
<img src="http://pi19404.github.io/pyVision/images/25/a251.png" alt="enter image description here" /></li>
  <li>Eclipse -&gt; Window -&gt; Preferences -&gt; Android -&gt; NDK -&gt; set path to the NDK
<img src="http://pi19404.github.io/pyVision/images/25/a252.png" alt="enter image description here" /></li>
</ul>

<h3 id="android-project"><strong>Android Project</strong></h3>

<ul>
  <li>In Eclipse create Android project to which you want to add C/C++ code 
For this examples a project called <code class="language-plaintext highlighter-rouge">AndroidOpenCV_v1</code> has been created</li>
</ul>

<h4 id="setting-up-for-cross-compilation"><strong>Setting up for Cross Compilation</strong></h4>

<ul>
  <li>The Eclipse IDE provides features for adding native C/C++ support to an existing Android based project.</li>
  <li>Right click on an Android project and select <code class="language-plaintext highlighter-rouge">Android Tools -&gt; Add native support</code> or Select the option <code class="language-plaintext highlighter-rouge">File-&gt;New-&gt;Other</code> from main menu) and select <code class="language-plaintext highlighter-rouge">Convert to a C/C++ Project</code>.</li>
</ul>

<p><img src="http://pi19404.github.io/pyVision/images/25/a253.png" alt="enter image description here" /></p>

<ul>
  <li>Enter the desired library name : In the present article we enter the name as <code class="language-plaintext highlighter-rouge">OpenVision</code></li>
</ul>

<p>This will configure the Android Project for the native build.</p>

<ul>
  <li>You will be able to see additional options related to native build
    <ul>
      <li>C/C++ build</li>
      <li>C/C++ general</li>
      <li>CDT builder option in <code class="language-plaintext highlighter-rouge">Project Properties-&gt;Builders</code> menu</li>
    </ul>
  </li>
</ul>

<h4 id="configure-cc-compilation-for-android-build"><strong>configure C/C++ compilation for android build</strong></h4>

<ul>
  <li>In the project properties Choose <code class="language-plaintext highlighter-rouge">C/C++ Build</code> option</li>
  <li>uncheck Use default build command and configure ndk-build as a build command</li>
  <li>ndk-build script must be in your path or specify absolute path</li>
</ul>

<p><img src="http://pi19404.github.io/pyVision/images/25/a254.png" alt="enter image description here" /></p>

<ul>
  <li>In Behaviour setting uncheck clean (ndk-build cleans project automatically on build and removes all existing libraries from libs/armeabi folders)</li>
</ul>

<p><img src="http://pi19404.github.io/pyVision/images/25/a255.png" alt="enter image description here" /></p>

<h4 id="configure-the-include-paths"><strong>Configure the include paths</strong></h4>

<ul>
  <li>Choose C/C++ General-&gt;Paths and Symbols and configure include path</li>
  <li>Add path to include directory which is located in <code class="language-plaintext highlighter-rouge">/opt/android-ndk-r7/platforms/android-15/arch/arm/usr/include</code> subdirectory which contains Android ndk to <code class="language-plaintext highlighter-rouge">GNU C</code> and <code class="language-plaintext highlighter-rouge">GNU C++ </code> include paths.</li>
  <li>Kindly note that Include path depends on target for which you are compiling (android-15 in my case — i.e. Android 4.0.3)</li>
  <li>We also need to include the paths to opencv include directory</li>
</ul>

<p><img src="http://pi19404.github.io/pyVision/images/25/a256.png" alt="enter image description here" /></p>

<h3 id="code">Code</h3>

<p>We will run a OpenCV based faced detection algorithm using OpenCV on the camera frames provided by AndroidCamera</p>

<ul>
  <li>
    <p>The native code C/C++ consists of <code class="language-plaintext highlighter-rouge">haarcascade_test.cpp</code> file which provides a high level interface to <code class="language-plaintext highlighter-rouge">haarcascade</code> class which run the face detection algorithm on downsampled version input frame and draws a Circle in the ROI the face is detected.</p>
  </li>
  <li>
    <p>The frames from camera are obtained using android API calls which is then passed to OpenCV for processing which is implemented in C/C++ and the output frame is passed back to android java code for rendering</p>
  </li>
  <li>
    <p>Create a jni subdirectory with main file <code class="language-plaintext highlighter-rouge">OpenVision.cpp</code> file and associated <code class="language-plaintext highlighter-rouge">Android.mk</code> and <code class="language-plaintext highlighter-rouge">Application.mk</code> make file</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Android.mk</code> file.This file is like a standard make file containing the include paths,source files,library dependencies etc.Few of the syntaxes are specific to android build and explanation is provided in the comments</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Application.mk</code> file contains flags related to target,platform as well as additional compilation and link flags</p>
  </li>
  <li>Create/Copy all of the following files in the jni directory
    <ul>
      <li>haarcascade_test.cpp</li>
      <li>haarcascade_test.hpp</li>
      <li>Android.mk</li>
      <li>Application.mk</li>
    </ul>
  </li>
  <li>
    <p>copy the precompiled OpenCV libraries required for the build to <code class="language-plaintext highlighter-rouge">libs/armeabi2</code> directory.</p>
  </li>
  <li>We can now build the project which will trigger the native build and create a shared library <code class="language-plaintext highlighter-rouge">libOpenVision_naive.so</code> in the <code class="language-plaintext highlighter-rouge">libs/armeabi</code> and <code class="language-plaintext highlighter-rouge">libs/areabi-v7a</code> directories and all the OpenCV 3rd party libraries are also copied from the <code class="language-plaintext highlighter-rouge">libs/armeabi2</code> directory to <code class="language-plaintext highlighter-rouge">libs/armeabi</code> and <code class="language-plaintext highlighter-rouge">libs/armeabi-v7a</code> directories.</li>
</ul>

<p>However this cannot be directly called from java code since we have not configured JNI interface.</p>

<h4 id="java-jni-interface-code"><strong>Java JNI Interface code</strong></h4>

<ul>
  <li>Java Native Interface (JNI) enables code written in Java to access (bind to) code written in C/C++ (and vice-versa) thereby allowing developers to gain access to low-level OS APIs, reuse legacy code, and possibly even boost the execution performance.</li>
</ul>

<p>The java code for JNI Interface is as below</p>

<pre class="brush:java">

public class ProcessImage {
public static String APPLICATION_DIR=Environment.getExternalStorageDirectory().getAbsolutePath()+"/Android";
        
    	static { 
    	    //loading native and dependent 3rd party libraries
    		System.loadLibrary("opencv_core");
    		System.loadLibrary("opencv_imgproc");
    		System.loadLibrary("opencv_highgui");
    		System.loadLibrary("opencv_objdetect");
    		System.loadLibrary("OpenVision_native");
    		}
   

        public ProcessImage() { 
 initDetector(APPLICATION_DIR+"/haarcascade_frontalface_alt.xml");
        }

        public native int run(int width, int height, byte yuv[], int[] rgba);
        public native void initDetector(String name);
            
}
</pre>

<ul>
  <li>The function that are required to be called by java are declared as <code class="language-plaintext highlighter-rouge">native</code> and their implementation is found in C/C++ files.</li>
  <li>We also need to load the native library in this case <code class="language-plaintext highlighter-rouge">libOpenVision.so</code> in the java code which is performed by <code class="language-plaintext highlighter-rouge">System.loadLibrary</code> function call.</li>
</ul>

<h4 id="generate-header-files">Generate Header Files</h4>

<ul>
  <li>We must now generate header files for JNI interface.</li>
  <li>
    <p>Compile the android Project .This will generate the class file for <code class="language-plaintext highlighter-rouge">ProcessImage.java</code> file in the <code class="language-plaintext highlighter-rouge">bin/classes</code> directory</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">javah</code> is a  JDK tool that builds C-style header files from a given Java class that includes native methods</li>
  <li>Run the <code class="language-plaintext highlighter-rouge">javah</code> command with <code class="language-plaintext highlighter-rouge">jni</code> switch to generate the JNI Interface files with classpath including the <code class="language-plaintext highlighter-rouge">bin/classes</code> directory</li>
</ul>

<pre class="brush:python">
 
cd jni
javah -jni -classpath `pwd`/../bin/classes -jni com.example.androidopencv_v1.ProcessImage

</pre>

<ul>
  <li>
    <p>This will generate the header file
 <code class="language-plaintext highlighter-rouge">com_example_androidopencv_v1_ProcessImage.h</code> 
 in the <code class="language-plaintext highlighter-rouge">jni</code> directory</p>
  </li>
  <li>
    <p>Now we modify the file so that it calls the routines defined in the native calls</p>
  </li>
  <li>
    <p>The function declarations in header files are of the form</p>
  </li>
</ul>

<pre class="brush:cpp">

JNIEXPORT void JNICALL Java_com_example_androidopencv_1v1_ProcessImage_initDetector
  (JNIEnv * env, jobject obj, jstring javaString)

JNIEXPORT jint JNICALL Java_com_example_androidopencv_1v1_ProcessImage_run
  (JNIEnv *, jobject, jint, jint, jbyteArray, jintArray)

</pre>

<h4 id="native-method-arguments">Native Method Arguments</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">JNIEnv *env</code>, an interface pointer (pointer to a pointer) to a function table, where each entry in the table is a pointer to a function that enables Java-to-C/C++ integration.</li>
  <li>
    <p>The second argument is typically of type <code class="language-plaintext highlighter-rouge">jobject obj</code>, which is a reference to the object on which the method is invoked for In case of instance methods and ` jclass clazz`which is a reference to the class in which the method is defined in case of static methods.</p>
  </li>
  <li>C/C++ primitives vary in size, depending on the platform while java primitives are well defined.</li>
  <li>
    <p>To provide inter-operability with C/C++, jni.h defines the following between standard java and C/C++ primitives (taken from https://thenewcircle.com/s/post/1292/jni_reference_example)</p>
  </li>
  <li>The JNI includes a number of pre-defined reference types (passed as opaque references in C) that correspond to different kinds of Java object types:</li>
</ul>

<p><img src="http://pi19404.github.io/pyVision/images/25/a257.png" alt="enter image description here" /></p>

<ul>
  <li>All objects passed to native code and returned from JNI functions are considered local references .Thus datatypes like arrays,strings need to be accessed via a accessor functions provided by JNI.</li>
</ul>

<p><img src="http://pi19404.github.io/pyVision/images/25/a258.png" alt="enter image description here" /></p>

<pre class="brush:cpp">

//access string
const char *name = (*env)-&gt;GetStringUTFChars(env, javaString, 0);

//access integer array
jint *_yuv = env-&gt;GetIntArrayElements(array, NULL);

//access byte array
jbyte* _bgra=env-&gt;GetByteArrayElements(oarray,NULL);

</pre>

<p>when the accessed data is no longer required we need to free the data</p>

<pre class="brush:cpp">

//release memory taken by UTF string locally
env-&gt;ReleaseStringUTFChars(javaString, name);

//release memory take up by integer array _yuv
env-&gt;ReleaseIntArrayElements(array, _yuv, 0);

//release memory take by the byte array _bgra
env-&gt;ReleaseByteArrayElements(oarray, _bgra, 0);

</pre>

<ul>
  <li>Also we will be including the header file in <code class="language-plaintext highlighter-rouge">OpenVision.cpp</code> file.Thus <code class="language-plaintext highlighter-rouge">g++</code> will be used for compilation of the code . If the code is included in <code class="language-plaintext highlighter-rouge">c</code>  file then <code class="language-plaintext highlighter-rouge">gcc</code> will be used for compilation</li>
  <li>Kindly note that the syntax for extracting data from JNI datatypes differ are different for C/C++ functions.</li>
</ul>

<h4 id="building-the-project"><strong>Building the project</strong></h4>

<p>After building the project the <code class="language-plaintext highlighter-rouge">libOpenVision.so </code> files can be found in the <code class="language-plaintext highlighter-rouge">libs/armeabi</code> and <code class="language-plaintext highlighter-rouge">libs/armeabi-v7a</code> directories.These have been cross-compiled for use on android based devices.</p>

<p>These can now be loaded and called from java application using JNI Interface</p>

<pre class="brush:java">

    	static { 
    	    //loading native and dependent 3rd party libraries
    		System.loadLibrary("opencv_core");
    		System.loadLibrary("opencv_imgproc");
    		System.loadLibrary("opencv_highgui");
    		System.loadLibrary("opencv_objdetect");    	    
    		System.loadLibrary("OpenVision_native");                 
    		}


</pre>

<ul>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">System.loadLibrary</code> function call is used to load the native libraries.</p>
  </li>
  <li>
    <p>The native functions can be called as standard java functions</p>
  </li>
</ul>

<pre class="brush:java">

ProcessImage opencvp=new ProcessImage();

//initializes the face detector
initDetector(APPLICATION_DIR+"/haarcascade_frontalface_alt.xml");

//android camera call back function,where data is returned as  byte array
public void onPreviewFrame(byte[] data, Camera camera)
{

// mDrawOnTop.mImageWidth - image width
//mDrawOnTop.mImageHeight - image height

//allocate memory for output bitmap data
 mDrawOnTop.mRGBData = new int[mDrawOnTop.mImageWidth * mDrawOnTop.mImageHeight];

//allocating and copying byte array
mDrawOnTop.mYUVData = new byte[data.length];
System.arraycopy(data, 0, mDrawOnTop.mYUVData, 0, data.length);

//calling the native function 
opencvp.run(mDrawOnTop.mImageWidth, mDrawOnTop.mImageHeight, mDrawOnTop.mYUVData, mDrawOnTop.mRGBData)

}
</pre>

<h3 id="code-1"><strong>Code</strong></h3>

<p>The android project can be found at <code class="language-plaintext highlighter-rouge">adroid/AndroidOpenCV_v1</code> subdirectory of  https://github.com/pyVision/root github repository</p>

</article>
<div id="page-navigation"> 
        <div class="clear">&nbsp;</div> 
        <div class="left"> 
         
                <a href="/pyVision//2015/04/17/27/" title="Previous Post: 
Git Subtree Installation and Usage on Linux">&laquo; Git Subtree Installation and Usage on Linux</a> 
         
        </div> 

        <div class="right"> 
         
                <a href="/pyVision//2015/04/18/29/" title="next Post: 
OpenCV 2.4.11 Build from Sources for Linux and Android">OpenCV 2.4.11 Build from Sources for Linux and Android &raquo; </a> 
         
        </div> 
        <div class="clear">&nbsp;</div> 
</div> 
<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'pi19404'; // required: replace example with your forum shortname
    			var disqus_identifier = '/2015/04/17/28/';
    			var disqus_url = 'http://pyvision.github.com/2015/04/17/28/';       
 
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





      </div>
    </div>

      
       <footer>
          pyVision is maintained by <a href="https://github.com/pi19404">pi19404</a><br>
        </footer>
    
    </div>
 <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = true;
        }, false);
      })(document);
    </script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pyvision'; // required: replace example with your forum shortname
    var disqus_identifier = '/2015/04/17/28/';
    var disqus_url = 'http://pyvision.github.com/2015/04/17/28/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

  </body>
</html>
