<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
  <!-- Enable responsiveness on mobile devices-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">-->
 

  <title>
    
      Program Arduino Sketch Files From Commandline &middot; 
      pyVision
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/pyVision/public/css/poole.css">
  <link rel="stylesheet" href="/pyVision/public/css/syntax.css">
  <link rel="stylesheet" href="/pyVision/public/css/lanyon.css">
  <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">-->
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/pyVisionpublic/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/pyVisionpublic/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({ 
                config: ["MMLorHTML.js"], 
                extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"], 
                jax: ["input/TeX"], 
                tex2jax: { 
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ], 
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ], 
                    processEscapes: false 
                }, 
                TeX: { 
                    TagSide: "right", 
                    TagIndent: ".8em", 
                    MultLineWidth: "85%", 
                    equationNumbers: { 
                       autoNumber: "AMS", 
                    }, 
                    unicode: { 
                       fonts: "STIXGeneral,'Arial Unicode MS'" 
                    } 
                }, 
                showProcessingMessages: false 
            }); 
</script>
<!--<script src="/pyVision/javascripts/gitdata.js"></script>-->
	<script type="text/javascript">
    	$(function() {
        $("#display-projects").getRepos("pi19404"); //Add your github username.
    	});
	</script>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shCore.css' rel='stylesheet' type='text/css'/> 
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/> 
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shCore.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCpp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCSharp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCss.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJava.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJScript.js' type='text/javascript' /> </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPhp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPython.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushRuby.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushSql.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushVb.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushXml.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPerl.js' type='text/javascript' > </script>
<script language='javascript'> 
SyntaxHighlighter.config.bloggerMode = false;
SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38535188-2', 'auto');
  ga('send', 'pageview');

</script>
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">





  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/pyVision/">Home </a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pyVision//about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    

    <!-- <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision/zipball/master">Download</a>
    <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision">GitHub project</a> -->
    <a class="sidebar-nav-item" ><g:plusone size="medium">Categories</g:plusone> </a>
    <div>
      <ul>
        
        
        <li><a href="/pyVision//category/Linux/index.html">Linux</a></li>
        
        
        <li><a href="/pyVision//category/Signal+Processing/index.html">Signal Processing</a></li>
        
        
        <li><a href="/pyVision//category/Raspberry+PI/index.html">Raspberry PI</a></li>
        
        
        <li><a href="/pyVision//category/Software/index.html">Software</a></li>
        
        
        <li><a href="/pyVision//category/Embedded+Firmware/index.html">Embedded Firmware</a></li>
        
        
        <li><a href="/pyVision//category/Software+Installation/index.html">Software Installation</a></li>
        
        
        <li><a href="/pyVision//category/Software+installation/index.html">Software installation</a></li>
        
        </ul>
    
    </div>
<a class="sidebar-nav-item" >
<div class='g-person' data-href='https://plus.google.com/115840780257908006648' data-layout='landscape' data-rel='author' data-showcoverphoto='false' data-showtagline='false' data-theme='dark' data-width='100'></a>
</div>

<div class='widget-content'>
<script type="text/javascript" src="http://jj.revolvermaps.com/2/1.js?i=9bj6dpaloim&amp;s=220&amp;m=7&amp;v=true&amp;r=true&amp;b=ffffff&amp;n=false&amp;c=ff0000" async="async"></script>
</div>

<script type="text/javascript">
function cantload() {
img = document.getElementById("clustrMapsImg");
img.onerror = null;
img.src = "http://www2.clustrmaps.com/images/clustrmaps-back-soon.jpg";
document.getElementById("clustrMapsLink").href = "http://www2.clustrmaps.com";
}
img = document.getElementById("clustrMapsImg");
img.onerror = cantload;
</script>
<div class='widget-content'>
<div id="clustrmaps-widget"></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://pi-virtualworld.blogspot.com', 'user' : 1165875, 'server' : '3', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2015-04-05', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www3.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www3.clustrmaps.com/user/ace11ca33"><img src="http://www3.clustrmaps.com/stats/maps-no_clusters/pi-virtualworld.blogspot.com-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript>
</a>

<!-- Copyright (c)2009 Site Meter -->


</div>

<div class='widget-content'>
<script type="text/javascript" src="http://feedjit.com/serve/?vv=1022&amp;tft=3&amp;dd=0&amp;wid=f31e21a2d981f025&amp;pid=0&amp;proid=0&amp;bc=000000&amp;tc=F5F5F5&amp;brd1=454545&amp;lnk=C95050&amp;hc=FFFFFF&amp;hfc=5C5A5A&amp;btn=8A0214&amp;ww=200&amp;went=10"></script><noscript><a href="http://feedjit.com/">Feedjit Live Blog Stats</a></noscript>
</div>
 
<!-- Site Meter -->
<script type="text/javascript" src="http://s30.sitemeter.com/js/counter.js?site=s30pi19404">
</script>
<noscript>
<a href="http://s30.sitemeter.com/stats.asp?site=s30pi19404" target="_top">
<img src="http://s30.sitemeter.com/meter.asp?site=s30pi19404" alt="Site Meter" border="0"/></a>
</noscript>   
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2022. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      
        <div class="container">
          <h1 class="header">
            <a href="/" title="Home">pyVision</a></br>
            <small>A Machine Learning and Signal Processing toolbox</small>
          </h1>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/pi19404/pyVision/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/pi19404/pyVision/tarball/master" id="download-tar-gz" class="button"><span>Download.tar.gz</span></a>
          <a href="https://github.com/pi19404/pyVision" id="view-on-github" class="button"><span>View on GitHub</span></a>
		
	   <hr>
          </section>
    
	</br>	</br>
      <div class="content">
        <article class="post">
  <h1 class="post-title">Program Arduino Sketch Files From Commandline</h1>
  <span class="post-date">06 Dec 2014</span>
  <h3 id="introduction">Introduction</h3>

<p>In this article we will look at how to program Arduino Sketch files from commandline</p>

<h3 id="arduino">Arduino</h3>

<p>Arduino  is an open-source physical computing platform based on a simple i/o board and a development environment that implements the Processing/Wiring language.</p>

<p>Once Arduino board is connected to the USB port of Raspberry PI ,It will power on through the port.
We can program and communicate with the Arduino throught the USB Port using Serial Communication Protocol.</p>

<p>If the Arduino is detected properly by Raspberry PI a file <code class="language-plaintext highlighter-rouge">/dev/ttyUSBX</code> or /dev/ttyACMX` will be created.</p>

<p>Following lines may be observed in the output of <code class="language-plaintext highlighter-rouge">dmeg |tail </code> command</p>
<pre class="brush:python">

 #dmeg |tail 
[21748.171290] usb 1-1.2: new full-speed USB device number 5 using dwc_otg
[21748.285641] usb 1-1.2: New USB device found, idVendor=2341, idProduct=0042
[21748.285679] usb 1-1.2: New USB device strings: Mfr=1, Product=2, SerialNumber=220
[21748.285695] usb 1-1.2: Manufacturer: Arduino (www.arduino.cc)
[21748.285708] usb 1-1.2: SerialNumber: 85334333931351907011
[21748.349390] cdc_acm 1-1.2:1.0: ttyACM0: USB ACM device
[21748.354136] usbcore: registered new interface driver cdc_acm
[21748.354174] cdc_acm: USB Abstract Control Model driver for USB modems and ISDN adapters

</pre>

<p>The Arduino detected can be also verified form ` lsusb` command output</p>

<pre class="brush:python">

pi@raspberrypi ~ $ lsusb
Bus 001 Device 002: ID 0424:9514 Standard Microsystems Corp. 
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. 
Bus 001 Device 004: ID 148f:5370 Ralink Technology, Corp. RT5370 Wireless Adapter
**Bus 001 Device 005: ID 2341:0042 Arduino SA Mega 2560 R3 (CDC ACM)**


</pre>

<h3 id="udev-rulse">UDEV Rulse</h3>

<p>if <code class="language-plaintext highlighter-rouge">/dev/ttyUSBX</code> or <code class="language-plaintext highlighter-rouge">/dev/ttyACMX</code> files are not found.It means that the Raspberry PI has not identified that Arduino is connected to it</p>

<p>Let us again refer the output of <code class="language-plaintext highlighter-rouge">lsusb</code> command</p>

<p>2341a is the vendor ID
0042 is the product ID</p>

<p>Go To the <code class="language-plaintext highlighter-rouge">/etc/udev/rules.d/</code> directory</p>

<p>Create a file named <code class="language-plaintext highlighter-rouge">99-arduino.rules</code></p>

<p>&lt;pre class=’brush:python”&gt;</p>

<p>SUBSYSTEMS==”usb”, ATTRS{idProduct}==”2341a”, ATTRS{0042}==”YYYY”, SYMLINK+=”ttyACM%n”</p>

<p>or</p>

<p>SUBSYSTEMS==”usb”, ATTRS{2341a}==”XXXX”, ATTRS{0042}==”YYYY”, SYMLINK+=”ttyUSB%n”
&lt;/pre&gt;</p>

<p>Finally reload the udev rules</p>

<p>` udevadm control –reload_rules`</p>

<h3 id="setting-the-permissions">Setting the Permissions</h3>

<pre class="brush:python">

pi@raspberrypi ~ $ ls -l /dev/ttyACM0 
crw-rw---T 1 root dialout 166, 0 Jan  1  1970 /dev/ttyACM0
pi@raspberrypi ~ $ 


</pre>

<p>We can see that only root users and users belonging to group <code class="language-plaintext highlighter-rouge">dialout</code> have permission to access the device files and hence communicate over the USB-Serial Interface.</p>

<p>To enable other users to communicate over the interface we need to add the user to the dialout gropup</p>

<p><code class="language-plaintext highlighter-rouge">usermod -a -G group-name username</code></p>

<p>Also check the <code class="language-plaintext highlighter-rouge">/var/lock</code> or <code class="language-plaintext highlighter-rouge">/run/lock</code> directory for permissions which are created at boot time</p>

<pre class="brush:python">

pi@raspberrypi ~ $ ls -ld /run/lock
drwxrwxrwt 2 root root 40 Dec  6 15:17 /run/lock

</pre>

<p>This 777 permission hence no issues</p>

<p>If users other that root do not have permission to access the directory then we need to change the configuration</p>

<p>You can include the commands to run on boot</p>

<p><code class="language-plaintext highlighter-rouge">sudo chmod o+rwx /run/lock</code></p>

<p>or</p>

<p><code class="language-plaintext highlighter-rouge">sudo chmod o+rwx /var/lock</code></p>

<h3 id="arduino-ide">ARDUINO IDE</h3>

<p>The arduino integrated development environment allows editing, compiling and uploading sketches (programs) for Arduino (and compatible) microcontroller boards.</p>

<p>Normally, running the arduino command starts the IDE, optionally loading any .ino files specified on the commandline.</p>

<p>Running the compilation and build from commandline is only available for Arduino version 1.5.x or higher.This version is not available in standard repositories.The command line options can be found at link <code class="language-plaintext highlighter-rouge">https://github.com/arduino/Arduino/blob/ide-1.5.x/build/shared/manpage.adoc</code></p>

<p>Another alrenative is to install anduino-mk utility
` sudo apt-get install arduino-mk`</p>

<p>The arduino-mk will install general purpose Arduino make file at <code class="language-plaintext highlighter-rouge">/usr/share/arduino/Arduino.mk</code></p>

<p>In this article we will look at this approach</p>

<h4 id="creating-makefile">Creating Makefile</h4>
<p>First step is to create a makefile in the same directory as the sketch file</p>

<pre class="brush:python">

BOARD_TAG    = mega2560         # Here goes your board type, e.g. : uno
ARDUINO_PORT = /dev/ttyACM0 # Change to your own tty interface
AVR_TOOLS_DIR=/usr/share/arduino/tools

ARDUINO_LIBS = # The libs needed by your sketchbook, examples are : Wire Wire/utility Ethernet...

ISP_PROG	   = stk500v2
ISP_PORT = /dev/ttyACM0
AVRDUDE_ISP_BAUDRATE=115200


include /usr/share/arduino/Arduino.mk # This is where arduino-mk installed

</pre>

<p>If you are not sure of board name to be used leave it blank initially and type the below command</p>

<pre class="brush:python">

make show_boards`

.....
mega         Arduino Mega (ATmega1280)
**mega2560     Arduino Mega 2560 or Mega ADK**
mini         Arduino Mini w/ ATmega168

....

</pre>

<p>In the present case the board was Arduino Mega hence the board name in the Makefile should be entered as <code class="language-plaintext highlighter-rouge">mega2560</code></p>

<p>The ISP Program should contain the protocol used to commuicate with the Arduino Bootloader</p>

<p>Arduino MEGA (1280 and 2560)  bootloader  uses the stk500v2 protocol operating at baud rate of 115200 while Arduino Uno uses stk500v1 protocol.The boot loaders and baud rate are  are board specific.The exact configuration for the board can be found by programming the Arduino from IDE with verbose upload output enabled from Preferences Menu.</p>

<p>Below is verbose output for Arduino-Mega board</p>
<pre class="brush:python">

/usr/share/arduino/hardware/tools/avrdude -C/usr/share/arduino/hardware/tools/avrdude.conf -v -v -v -v -patmega2560 -cstk500v2 -P/dev/ttyACM0 -b115200 -D -Uflash:w:/tmp/build6124755445833805312.tmp/test.cpp.hex:i

</pre>

<p>we can now use the command make to compile your sketch, and make upload to send it to the board.
The makefile uses <code class="language-plaintext highlighter-rouge">avrdude</code> utility to upload the hex file to arduino.</p>

<pre class="brush:python">

sudo make
sudo make upload

</pre>

<p>If the arduino utility is waiting from user inputs it can be passed through the serial interface.
A serial listner can be opened on the Raspberry pi for programming pruposes</p>

<p>The code for the same is found below</p>

<pre class="brush:python">

 #! /usr/bin/python

 #    Serial Reader for ARDUINO
 #    usefull when tail -f /dev/ttyXXXX doesn't work
 #
 #    Change ttyACM0 for your own tty interface

import serial
import time

 # The second argument is the baudrate, change according to the baudrate you gave to your Serial.begin command
ser = serial.Serial("/dev/ttyACM0", 115200)

 # To avoid communication failure due to bad timings
ser.setDTR(True);
time.sleep(1);
ser.setDTR(False)

while True:
    print ser.readline()


</pre>

<h3 id="references">References</h3>

<ul>
  <li>http://playground.arduino.cc/Linux/All</li>
  <li>https://github.com/sudar/Arduino-Makefile</li>
  <li>http://hardwarefun.com/tutorials/compiling-arduino-sketches-using-makefile</li>
  <li>http://baldwisdom.com/bootloading/</li>
</ul>


</article>
<div id="page-navigation"> 
        <div class="clear">&nbsp;</div> 
        <div class="left"> 
         
                <a href="/pyVision//linux/2014/12/05/17/" title="Previous Post: 
Starting Programs at Boot using Supervisor Process Control Utility">&laquo; Starting Programs at Boot using Supervisor Process Control Utility</a> 
         
        </div> 

        <div class="right"> 
         
                <a href="/pyVision//signal%20processing/2014/12/08/19/" title="next Post: 
Wavelet Two Channel FilterBank">Wavelet Two Channel FilterBank &raquo; </a> 
         
        </div> 
        <div class="clear">&nbsp;</div> 
</div> 
<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'pi19404'; // required: replace example with your forum shortname
    			var disqus_identifier = '/2014/12/06/18/';
    			var disqus_url = 'http://pyvision.github.com/2014/12/06/18/';       
 
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





      </div>
    </div>

      
       <footer>
          pyVision is maintained by <a href="https://github.com/pi19404">pi19404</a><br>
        </footer>
    
    </div>
 <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = true;
        }, false);
      })(document);
    </script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pyvision'; // required: replace example with your forum shortname
    var disqus_identifier = '/2014/12/06/18/';
    var disqus_url = 'http://pyvision.github.com/2014/12/06/18/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

  </body>
</html>
