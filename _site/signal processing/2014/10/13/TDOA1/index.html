<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
  <!-- Enable responsiveness on mobile devices-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">-->
 

  <title>
    
      Time Delay Estimation Techniques - Part 1 &middot; 
      pyVision
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/pyVision/public/css/poole.css">
  <link rel="stylesheet" href="/pyVision/public/css/syntax.css">
  <link rel="stylesheet" href="/pyVision/public/css/lanyon.css">
  <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">-->
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/pyVisionpublic/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/pyVisionpublic/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({ 
                config: ["MMLorHTML.js"], 
                extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"], 
                jax: ["input/TeX"], 
                tex2jax: { 
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ], 
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ], 
                    processEscapes: false 
                }, 
                TeX: { 
                    TagSide: "right", 
                    TagIndent: ".8em", 
                    MultLineWidth: "85%", 
                    equationNumbers: { 
                       autoNumber: "AMS", 
                    }, 
                    unicode: { 
                       fonts: "STIXGeneral,'Arial Unicode MS'" 
                    } 
                }, 
                showProcessingMessages: false 
            }); 
</script>
<!--<script src="/pyVision/javascripts/gitdata.js"></script>-->
	<script type="text/javascript">
    	$(function() {
        $("#display-projects").getRepos("pi19404"); //Add your github username.
    	});
	</script>
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shCore.css' rel='stylesheet' type='text/css'/> 
<link href='http://alexgorbatchev.com/pub/sh/2.1.364/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/> 
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shCore.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCpp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCSharp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushCss.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJava.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushJScript.js' type='text/javascript' /> </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPhp.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPython.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushRuby.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushSql.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushVb.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushXml.js' type='text/javascript' > </script>
<script src='http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushPerl.js' type='text/javascript' > </script>
<script language='javascript'> 
SyntaxHighlighter.config.bloggerMode = false;
SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38535188-2', 'auto');
  ga('send', 'pageview');

</script>
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">





  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/pyVision/">Home </a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/pyVision//about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
    
      
    

    <!-- <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision/zipball/master">Download</a>
    <a class="sidebar-nav-item" href="http://www.github.com/pi19404/pyVision">GitHub project</a> -->
    <a class="sidebar-nav-item" ><g:plusone size="medium">Categories</g:plusone> </a>
    <div>
      <ul>
        
        
        <li><a href="/pyVision//category/Linux/index.html">Linux</a></li>
        
        
        <li><a href="/pyVision//category/Signal+Processing/index.html">Signal Processing</a></li>
        
        
        <li><a href="/pyVision//category/Raspberry+PI/index.html">Raspberry PI</a></li>
        
        
        <li><a href="/pyVision//category/Software/index.html">Software</a></li>
        
        
        <li><a href="/pyVision//category/Embedded+Firmware/index.html">Embedded Firmware</a></li>
        
        
        <li><a href="/pyVision//category/Software+Installation/index.html">Software Installation</a></li>
        
        
        <li><a href="/pyVision//category/Software+installation/index.html">Software installation</a></li>
        
        </ul>
    
    </div>
<a class="sidebar-nav-item" >
<div class='g-person' data-href='https://plus.google.com/115840780257908006648' data-layout='landscape' data-rel='author' data-showcoverphoto='false' data-showtagline='false' data-theme='dark' data-width='100'></a>
</div>

<div class='widget-content'>
<script type="text/javascript" src="http://jj.revolvermaps.com/2/1.js?i=9bj6dpaloim&amp;s=220&amp;m=7&amp;v=true&amp;r=true&amp;b=ffffff&amp;n=false&amp;c=ff0000" async="async"></script>
</div>

<script type="text/javascript">
function cantload() {
img = document.getElementById("clustrMapsImg");
img.onerror = null;
img.src = "http://www2.clustrmaps.com/images/clustrmaps-back-soon.jpg";
document.getElementById("clustrMapsLink").href = "http://www2.clustrmaps.com";
}
img = document.getElementById("clustrMapsImg");
img.onerror = cantload;
</script>
<div class='widget-content'>
<div id="clustrmaps-widget"></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://pi-virtualworld.blogspot.com', 'user' : 1165875, 'server' : '3', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2015-04-05', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www3.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www3.clustrmaps.com/user/ace11ca33"><img src="http://www3.clustrmaps.com/stats/maps-no_clusters/pi-virtualworld.blogspot.com-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript>
</a>

<!-- Copyright (c)2009 Site Meter -->


</div>

<div class='widget-content'>
<script type="text/javascript" src="http://feedjit.com/serve/?vv=1022&amp;tft=3&amp;dd=0&amp;wid=f31e21a2d981f025&amp;pid=0&amp;proid=0&amp;bc=000000&amp;tc=F5F5F5&amp;brd1=454545&amp;lnk=C95050&amp;hc=FFFFFF&amp;hfc=5C5A5A&amp;btn=8A0214&amp;ww=200&amp;went=10"></script><noscript><a href="http://feedjit.com/">Feedjit Live Blog Stats</a></noscript>
</div>
 
<!-- Site Meter -->
<script type="text/javascript" src="http://s30.sitemeter.com/js/counter.js?site=s30pi19404">
</script>
<noscript>
<a href="http://s30.sitemeter.com/stats.asp?site=s30pi19404" target="_top">
<img src="http://s30.sitemeter.com/meter.asp?site=s30pi19404" alt="Site Meter" border="0"/></a>
</noscript>   
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2022. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      
        <div class="container">
          <h1 class="header">
            <a href="/" title="Home">pyVision</a></br>
            <small>A Machine Learning and Signal Processing toolbox</small>
          </h1>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/pi19404/pyVision/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/pi19404/pyVision/tarball/master" id="download-tar-gz" class="button"><span>Download.tar.gz</span></a>
          <a href="https://github.com/pi19404/pyVision" id="view-on-github" class="button"><span>View on GitHub</span></a>
		
	   <hr>
          </section>
    
	</br>	</br>
      <div class="content">
        <article class="post">
  <h1 class="post-title">Time Delay Estimation Techniques - Part 1</h1>
  <span class="post-date">13 Oct 2014</span>
  <h3 id="introduction">Introduction</h3>

<p>In this article we will look at signal processing techniques for time delay estimation.</p>

<h3 id="background">Background</h3>

<p>Time delay estimation has been a research topic of significant practical importance in
many fields like radar, sonar, seismology, geophysics, ultrasonic’s, hands-free communications,Doppler positioning systems etc and is of fundamental importance in a variety of signal-processing applications.</p>

<p>The problem boils down to computing the location of a digitized “signature” waveform residing within a larger time-slice.</p>

<p>Let $s(n)$ be the sound source signal.
Let us consider two  spatially separated sensors and $x_{1}(t)$ and $x_{2}(t)$ be result of propagation of $s(t)$ through different paths to reach the respective sensors.</p>

<p>A simple propagation model is that the signals just encounter attenuation and delay and are corrupted by additive noise</p>

<p>$x_{i}(t) =  a_{i} s(t- \tau_{i}) + b_{i}(t)$</p>

<p>where ,</p>

<p>$b_{i}(t)$ is the additive noise uncorrelated with the signal</p>

<p>We make a assumption that the distance from the sensors to the source is very large compared to the spatial separation between the sensors.Thus signal $s(t)$ received by both the receivers is the same,there is no significant change in the signal as it travels thorough different paths to reach the spatially separated sensors.</p>

<h3 id="cross-correlation">Cross-correlation</h3>

<p>One of the simplest method of time delay estimation is cross-correlation .
The cross-correlation of two signals is a measure of similarity between the two sequences.
The cross-correlation function is maximized when both the signals have significant overlap.</p>

<p>$R_{xy}(k) = \sum_{i} {x(i) y(i+k)} = x[n]*y[-n]$</p>

<p>Compute maximum absolute value of the correlation function to estimate the lag.</p>

<p>To test the results we create  create two sequences,one a delayed version of another.
We add white noise to the delayed sequence and use sample correlation to detect the lag.
while performing correlation we normalize the signals,so that correlation measure is bounded
between [0,1]</p>

<p>Now we increase the noise to try to get estimate of noise co-variance at which this technique fails.
we run the experiment 100 times and estimate the number of times we get the proper answer.</p>

<h4 id="testing-with-different-additive-noise-covariance">Testing with Different Additive Noise Covariance</h4>
<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.1
SNR 15.4390474505
Correct  98  Incorrect  3
mean  9.90099009901 Std  1.0000490136
</pre>
<p>We see that we are always correct,when the noise levels are low or SNR is high</p>

<p><img src="/pyVision/images/blog/images/image9.png" alt="enter image description here" /></p>

<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.3
SNR 5.89662235611
Correct  48  Incorrect  53
mean  9.79207920792 Std  1.2767287382
</pre>
<p>The SNR has dropped to about 6db and error in estimation is about 50%. The accuracy is linearly
related with the SNR</p>

<p><img src="/pyVision/images/blog/images/image10.png" alt="enter image description here" /></p>

<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.5
SNR 1.45964736379
Correct  36  Incorrect  65
mean  9.80198019802 Std  1.57969668714

</pre>
<p>At 2 db SNR we can see the variance of estimated time delay increasing with rising noise levels.</p>

<p><img src="/pyVision/images/blog/images/image11.png" alt="enter image description here" /></p>

<p>We can see in the auto-correlation plot the difference between the peak and its neighbors is not significant and depending on the random noise levels introduced,we may not always get the right answer.</p>

<p>As noise increases,we can see variance in the estimated time delay increases and error in estimation also increases.As the level of noise increases, the uncertainty in the time-delay estimate increases</p>

<p>We need a reliable time delay estimator in presence of additive noise.</p>

<p>If is always difficult to estimate the time delays for a base-band signal illustrated above.The due to the noise,we are not reliably able to estimate the delay corresponding to the maximal overlap between the noisy and ideal signal.</p>

<pre class="brush:python">
def delay(signal,N):
    """ function introduces a delay of N samples 
    
    Parameters
    -----------
    signal : numpy-array,
             The input signal
             
    N      : integer
             delay
        
    Returns
    --------
    out : numpy-array
          delayed signal
    
    """
    d=numpy.zeros((1,N+1));    
    signal=numpy.append(d,signal)
    return signal;

def addNoise(s,variance):
    """ function add additive white gaussian noise to the input signal 
    
    Parameters
    -----------
    s : numpy-array,
             The input signal
             
    N      : float
             noise covariance
        
    Returns
    --------
    out : numpy-array
          noisy signal    
    
    """
    noise = np.random.normal(0,variance,len(s))                    
    s=s+noise;                              
    return s;


if __name__ == "__main__":  
            
        Fs=1000;
        
        mode=0
        if mode==0:
            x = triang(20);
            x2=x;

		......
            
        tdelay=10;
        varnoise=0.001;
        loop=1000

        
        #delay the signal
        dx=delay(x,tdelay);
        result=numpy.zeros((1,loop));
        for i in range(loop):
            s=dx;
            #add noise
            s=addNoise(s,varnoise);
            
            #normalize the signals
            s=s/np.linalg.norm(s);
            x1=x2/np.linalg.norm(x2);
            
            unfiltered_signal=s;
            
            r=numpy.correlate(s,x1,mode="full")
            arg=np.argmax(r)
            result[0,i]=abs(arg-len(x))     

		#plot the results
	    c=np.sum(result==tdelay)
        ic=np.sum(result!=tdelay)
        #10*np.log(np.sum(np.abs(x*x))/
        print " *********** Information ************ "
        print 'time delay : ',tdelay
        print 'Noise :',varnoise
        print "SNR",10*np.log(np.mean(abs(x*x))/(varnoise*varnoise))/np.log(10);
        print "Correct ",str(c)," Incorrect ",str(ic)
        print "mean ",np.mean(result),"Std ",np.std(result)
        print result
        plt.figure(1)
        subplot(2,2,1) 
        plt.plot(range(len(x)),x)
        xlabel('Time')
        ylabel('Amplitude')

        
        subplot(2,2,2) 
        plt.plot(range(len(unfiltered_signal)),unfiltered_signal)
        xlabel('Time')
        ylabel('Amplitude')

        subplot(2,2,3) 
        plt.plot(range(len(r)),r)
        xlabel('Time')
        ylabel('Amplitude')            
</pre>

<h3 id="rectangular-pulse-signals">Rectangular Pulse signals</h3>

<p>Let us look at the results for a different signal in the form of a rectangular pulse .
we will consider the wave of same duration 30.</p>

<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.5
SNR 0.791812460476
Correct  86  Incorrect  15
mean  9.92079207921 Std  1.11411438271
</pre>
<p>we see that signal has a lower SNR,but accuracy and estimated time delay variance is lower.</p>

<p><img src="/pyVision/images/blog/images/image12.png" alt="enter image description here" />
Thus the type of pulse we use has a impact on the accuracy of auto-correlation function.</p>

<pre class="brush:python">
def rectangular(N,start,end):
        """ fuction generates a rectangular pulse 
        
        Parameters
        ---------
        N : integer
            length of signal
            
        start,end: integer
                starting and ending index of pulse
        
        """
        x = np.zeros((1,N))
        x[:,start:end]=1;
        x=x.flatten();    
        return x;
 </pre>

<h3 id="coded-pulses">Coded Pulses</h3>
<p>Broadband  techniques have a sequence of code pulses that increase the accuracy of time delay estimation in the presence of noise.</p>

<pre class="brush : python ">
time delay :  10
Noise : 0.5
SNR 2.55272505103
Correct  95  Incorrect  6
mean  9.93069306931 Std  1.01725144864

</pre>

<p><img src="/pyVision/images/blog/images/image13.png" alt="enter image description here" /></p>

<pre class="brush:python">
x=rectangular(20,8,14)+rectangular(20,2,5)
</pre>

<p>But most of the time we do not have control of the source pulse.</p>

<p>In the remainder of the article we will assume that it is a rectangular pulse of duration 1000
with impulse of duration 50 starting at 100.</p>
<pre class="brush : python ">
time delay :  10
Noise : 0.5
SNR -6.98970004336
Correct  856  Incorrect  144
mean  9.991 Std  0.561176442841
</pre>

<p><img src="/pyVision/images/blog/images/image14.png" alt="enter image description here" /></p>

<pre class="brush:python">
x=rectangular(1000,100,150)
</pre>

<p>Now given source signal,we need to see if we can do better in the presence of additive noise atleast.In real life situations there will be a host of other distortions and effects which will  increase the estimation errors apart from noise.</p>

<p>For pulses like the ones observed above,noise is a dominant factor,signal energy is low compared to noise energy.</p>

<h3 id="modulated-pulses">Modulated Pulses</h3>

<p>Often the pulses are modulated by sinusoidal waves for longer range transmissions.
&lt;/pre&gt;
time delay :  10
Noise : 0.5
SNR -6.98970004336
Correct  988  Incorrect  12
mean  10.004 Std  0.109471457467
Actual time delay 10
&lt;/pre&gt;</p>

<p><img src="/pyVision/images/blog/images/image15.png" alt="enter image description here" /></p>

<pre class="brush:python">
def sinepulse(N,start,end,f,Fs=1000,tau=0):
        """ function generates modulated rectangular pulse

        Parameters
        ---------
        N : integer
            length of signal
            
        start,end: integer
                starting and ending index of pulse
                
        f   : integer
              modulated carrier freuency
              
        Fs  : integer
              Sampling freuency

        tau : integer
              carrier phase delay in samples.
              
        Returns
        --------
        out : numpy-array
              modulated rectangular  signal               
          
        """
        x = np.zeros((1,N))
        t=np.asarray(range(0,end-start));
        x[:,start:end]=np.cos(2*np.pi*f*(t+tau)/Fs);
        
        return x.flatten();
</pre>

<h3 id="carrier-synchronization-issues">Carrier Synchronization Issues</h3>

<p>we can synchronize exactly with the carrier ,then like broadband techniques we can achieve a significantly enhanced SNR. However synchronizations are never possible.</p>

<p>we introduce a phase delay of 1 sample to check the effect of carrier phase errors</p>
<pre class="brush : python ">
*********** Information ************ 
time delay :  10
Noise : 0.3
SNR -2.55272505103
Correct  2  Incorrect  998
mean  229.036 Std  244.973840857

</pre>

<p><img src="/pyVision/images/blog/images/image16.png" alt="enter image description here" /></p>

<p>In such cases another approach might be to use rectangular envelope
but in the present case that also does not seem to help</p>

<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.3
SNR -2.55272505103
Correct  0  Incorrect  1000
mean  325.336 Std  272.058543523

</pre>
<h4 id="envelope-detection">Envelope Detection</h4>
<p>We perform envelope detection on the signal and then apply correlation.
This improves the situation considerably</p>

<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.3
SNR -2.55272505103
Correct  661  Incorrect  339
mean  9.746 Std  0.793400277288
</pre>

<p><img src="/pyVision/images/blog/images/image17.png" alt="enter image description here" /></p>

<pre class="brush : python ">
            if mode==5 or mode ==6 or mode==7:                
                s=abs(scipy.signal.hilbert(s))
</pre>

<h3 id="filtering">Filtering</h3>

<p>If we known the carrier frequency ,we can filter the noise outside the signal  bandwidth before performing the correlation operation.</p>

<p>For the remaining examples we consider signal with carrier frequency of 1KHz and Sampling rate
of 5Khz. The reason for that is explained below</p>

<p>Let us first look at the frequency characteristics of the rectangular pulse</p>

<p><img src="/pyVision/images/blog/images/image26.png" alt="enter image description here" /></p>

<p>The sharp transition at the edges of the rectangular pulse give rise to high frequency components.
Thus while filtering we need to take these into account,else we may end up distorting the edge
leading to errors in time delay estimation.</p>

<p>The width of the mainlobe in frequency domain is inversely proportional to width of rectangular pulse
in the time domain.Thus a wider pulse in the time domain will provide higher spectral compression in the frequency domain.</p>

<p>we can see that main lobe of the rectangular pulse would have normalize freuency of 0.05
Few of the side lobes also contain significant information.</p>

<pre class="brush:python">

def plotFrequency(b,a=1):
    """ the function plots the frequency and phase response """
    w,h = signal.freqz(b,a)
    h_dB = abs(h);#20 * np.log(abs(h))/np.log(10)
    subplot(211)
    plot(w/max(w),h_dB)
    #plt.ylim(-150, 5)
    ylabel('Magnitude (db)')
    xlabel(r'Normalized Frequency (x$\pi$rad/sample)')
    title(r'Frequency response')
    subplot(212)
    h_Phase = np.unwrap(np.arctan2(np.imag(h),np.real(h)))
    plot(w/max(w),h_Phase)
    ylabel('Phase (radians)')
    xlabel(r'Normalized Frequency (x$\pi$rad/sample)')
    title(r'Phase response')
    plt.subplots_adjust(hspace=0.5)
</pre>

<p>We try with a normalized frequency components of 0.05 which contains around 3 adjacent side-lobes</p>

<p><img src="/pyVision/images/blog/images/image31.png" alt="enter image description here" /></p>

<p>we can see that the signal has been attenuated near the edges.Thus the distortion in the region where the pulse starts will lead  to ambiguity of time delay computation.</p>

<p>Thus we need to consider the freuency components to retain so that sharp transition in time domain are not affected</p>

<p>The carrier freuency is 1Khz .The normalized carrier frequency at sampling rate of 5Khz is 0.4.
Thus the spectrum of modulated rectangular pulse is centered at 0.4</p>

<p><img src="/pyVision/images/blog/images/image30.png" alt="enter image description here" /></p>

<p>Thus significant frequency band lies from 0.3 to 0.5.</p>

<p>If we bandpass filter frequencies in this band,we should get a relatively noiseless waveform,which is expected to improve the performance of correlation.</p>

<p>We apply band-pass  butter worth filter of order 2 with normalized cutoff frequencies are 0.2 and 0.6.</p>

<p><img src="/pyVision/images/blog/images/image33.png" alt="enter image description here" /></p>

<pre class="brush:python">
def butter_bandpass(lowcut, highcut, fs, order=5):
    """ function returns the bandpass butterworth filter coefficients 
    
    Parameters
    -------------    
    lowcut,highcut : integer
                     lower and higher cutoff freuencies in Hz
                     
    Fs : Integer
         Samping freuency in Hz

    order : Integer
            Order of butterworth filter                     
        
    Returns
    --------
    b,a - numpy-array
          filter coefficients 
          
    """
    nyq = 0.5 * fs
    low = lowcut / nyq
    high = highcut / nyq
    b, a = butter(order, [low,high], btype='bandpass')
    return b, a
    
    
def bandpass_filter(data, lowcut, highcut, fs, order,filter_type='butter_worth'):

 """ the function performs bandpass filtering 
    
    Parameters
    -------------
    data : numpy-array
           input signal
           
    lowcut,highcut : integer
                     lower and higher cutoff freuencies in Hz
                     
    Fs : Integer
         Samping freuency in Hz

    order : Integer
            Order of butterworth filter                     
        
    Returns
    --------
    out : numpy-array
          Filtered signal
    
    """
    global once
    if filter_type=='butter_worth':
        b, a = butter_bandpass(lowcut, highcut, fs, order=order)            
        if once==0:
            plt.figure(2)
            plotFrequency(b,a)
            once=1
        y = filtfilt(b, a, data)
        return y
    
</pre>

<p>The butter-worth band-pass filter is not a zero phase .It will introduce different phase delay depending of frequency. The.The phase plot of the band pass filter is not linear,</p>

<p>To see the phase delay effects of bandpass butter-worth filter,we consider the case of no noise .
we can see that instead of 10,delay is introduced as 12 due to butter-worth filter. However we have a stable singular correlation peak being detected</p>

<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.001
SNR 46.9897000434
Correct  0  Incorrect  1000
mean  12.0 Std  0.0
</pre>

<p><img src="/pyVision/images/blog/images/image34.png" alt="enter image description here" /></p>

<pre class="brush:python">
.....
        #introduce delay
        dx=delay(x,tdelay);
        result=numpy.zeros((1,loop));
        for i in range(loop):
            s=dx;

            #add noise            
            if varnoise!=0:
                s=addNoise(s,varnoise)

            #normalize signals                
            s=s/np.linalg.norm(s);
            x1=x2/np.linalg.norm(x2);
            if carrier!=None:
                unfiltered_signal=s;
                if mode==1:
                    s = bandpass_filter(s, carrier-500, carrier+500, Fs,order,filter_type)
                if mode==2:
                    s = bandpass_filter(s, carrier-750, carrier+750, Fs,order,filter_type)

                filtered_signal=s;
            else:
                unfiltered_signal=s;
             
            #perform envelope detection
            s=abs(scipy.signal.hilbert(s))
            if mode==1 or mode==2:
                r=numpy.correlate(s,x1,mode="full")

.......
</pre>
<p>To compensate for that we need to use zero phase filtering techniques like forward backward filtering.</p>

<p>To achieve zero phase the linear filter is applied twice, once forward and once backwards. The combined filter has zero phase.In general  forward-backward filtering squares the amplitude response and zeros the phase response if phase of filter is linear.</p>

<p>we see that there are few errors inspire of applying the forward backward algorithm due to distortions introduced by bandpass filtering of high frequency components.Though the mean is closer to actual delay of 10.</p>

<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0
Correct  0  Incorrect  1000
mean  9.0 Std  0.0
</pre>
<p>This tells us that we cannot eliminate the effects introduced due to filtering.</p>

<p>we now introduce noise and compare the performance against envelope detection.</p>
<pre class="brush : python ">
 *********** Information ************ 
time delay :  10
Noise : 0.3
SNR -2.55272505103
Correct  442  Incorrect  558
mean  9.49 Std  0.678159273327
</pre>
<pre class="brush : python ">
 *********** Envelope Detection ************ 
time delay :  10
Noise : 0.3
SNR -2.55272505103
Correct  661  Incorrect  339
mean  9.746 Std  0.793400277288
</pre>

<p>Compared to just envelope detection,we can see that standard deviation has reduced.Thus the neighborhood of estimated TDOA values are reduced,though the mean is shifted away from 10 may be due to the phase delay effects of bandpass filter.</p>

<p>Though band-pass filtering did not lead to a significant improvement  due no the noise within the frequency bandwidth .It is essential to keep out unwanted frequency components due to environmental noise and other factors.</p>

<h3 id="code">Code</h3>

<p>The code used in the article can be found in github repository <a href="https://github.com/pi19404/pyVision/tree/master/pySignalProc">“Github Link”</a></p>

<p>Files</p>

<ul>
  <li>TDOA1.py</li>
  <li>TODA2.py - Band Pass Filtering</li>
</ul>

<p>All the plots included in the article can generated by changing the mode variable in the files</p>


</article>
<div id="page-navigation"> 
        <div class="clear">&nbsp;</div> 
        <div class="left"> 
         
                <a href="/pyVision//signal%20processing/2014/10/11/DFT1/" title="Previous Post: 
Discrete Fourier Transform For Freuency Analysis">&laquo; Discrete Fourier Transform For Freuency Analysis</a> 
         
        </div> 

        <div class="right"> 
         
                <a href="/pyVision//signal%20processing/2014/10/19/TODA2/" title="next Post: 
Time Delay Estimation Techniques - part 2">Time Delay Estimation Techniques - part 2 &raquo; </a> 
         
        </div> 
        <div class="clear">&nbsp;</div> 
</div> 
<div id="disqus_thread"></div>
		<script type="text/javascript">
			/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
			var disqus_shortname = 'pi19404'; // required: replace example with your forum shortname
    			var disqus_identifier = '/signal%20processing/2014/10/13/TDOA1/';
    			var disqus_url = 'http://pyvision.github.com/signal%20processing/2014/10/13/TDOA1/';       
 
			/* * * DON'T EDIT BELOW THIS LINE * * */
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





      </div>
    </div>

      
       <footer>
          pyVision is maintained by <a href="https://github.com/pi19404">pi19404</a><br>
        </footer>
    
    </div>
 <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = true;
        }, false);
      })(document);
    </script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pyvision'; // required: replace example with your forum shortname
    var disqus_identifier = '/signal%20processing/2014/10/13/TDOA1/';
    var disqus_url = 'http://pyvision.github.com/signal%20processing/2014/10/13/TDOA1/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

  </body>
</html>
